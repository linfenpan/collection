/*!
    @author da宗熊
    @version 1.0.0
    @license ISC
    @lastModify 2016-11-16
    @repository https://github.com/linfenpan/collection/tree/master/plugins/swipe
    @example
        var swiper = new Swiper(element, options)
    @options
        [
          index[开始索引], ratio[每个子元素，占总宽度百分比 < 1], elastic[阻力大小 < 1],
          slideTime[滑动时间], resetTime[重置事件], nextDistance[到下一帧距离px或<1],
          interval[自动切换到下一帧的时间], repeat[是否循环], wrapSelector[wrap选择器],
          childSelector[子元素选择器], slideCallback[切换到下一帧的回调]
        ]
    @bug
        no listener at "transitionEnd" event, the behavior of the timer may be strange when we are away from the page
*/
!function(t){function i(){}function e(t){return"string"==typeof t?document.querySelector(t):t}function n(t,i,e,n){var s=i.split(" ");s.forEach(function(i,s){t.addEventListener(i,e,n||!1)})}function s(t,i){return t.hasOwnProperty(i)}function r(t){return[].slice.call(t,0)}function o(t,i){for(var e in t)s(t,e)&&i.call(t,t[e],e,t)}function a(t){return t in v||v.hasOwnProperty(t)?t:f+t.slice(0,1).toUpperCase()+t.slice(1)}function h(t,i){var e=t.style;o(i,function(t,i){e[a(i)]=t})}function c(t){var i=t.style[a("transform")];return i=i&&parseInt(i.match(/translateX\((.*?)\)/)[1])||0}function l(t,i,e){h(t,{transform:"translateX("+i+"px)",transitionDuration:(e||0)+"ms"})}function d(t,i){this.init(t,i)}var u=null,v=document.documentElement.style,f=function(t){for(var i="",e=["webkitT","MozT","msT","oT","t"],n=0,s=e.length;n<s;n++){var r=e[n];if(t.hasOwnProperty(r+"ransform")){i=r.slice(0,-1);break}}return i}(v),m=function(){function i(t){return t=t.targetTouches&&t.targetTouches[0]||t.changedTouches&&t.changedTouches[0]||t,{x:t.pageX,y:t.pageY}}var s={},r=/mobile/i.test(t.navigator.userAgent),o={start:r?"touchstart":"mousedown",move:r?"touchmove":"mousemove",end:r?"touchend touchcancel":"mouseup mouseleave",needCatch:"click"};return s.hold=function(t){t=e(t);var s={start:u,end:u,onStart:u,onMove:u,onEnd:u},a={onStart:function(t){var e=s.start=i(t);e.spaceX=e.spaceY=0,s.end=u,s.onStart&&s.onStart(e,t)},onMove:function(t){if(s.start){var i=a.calcDiffAfterStart(t),e=!(s.onMove&&s.onMove(i,t));e&&t.preventDefault()}},onEnd:function(t){if(s.start){var i=s.end=a.calcDiffAfterStart(t);s.start=null,s.onEnd&&s.onEnd(i,t)}},onPrevent:function(t){var i=s.end||{};Math.abs(i.spaceX)>1&&(t.preventDefault(),t.stopPropagation())},calcDiffAfterStart:function(t){var e=i(t);return e.spaceX=e.x-s.start.x,e.spaceY=e.y-s.start.y,e}};return n(t,o.start,a.onStart),n(t,o.move,a.onMove),n(t,o.end,a.onEnd),!r&&n(t,o.needCatch,a.onPrevent,!0),s},s}();d.prototype={$root:u,$wrap:u,$childs:u,$moves:u,$oldMoves:u,options:u,touchHolder:u,isNext:!1,isPrev:!1,isFirstMove:!1,isPreventMoving:!1,index:0,length:0,visibleCount:u,ratio:1,slideTime:300,resetTime:200,slideCallback:i,rootWidth:u,itemWidth:u,elastic:.3,oldNextDistance:u,nextDistance:.2,timer:u,interval:3e3,repeat:!0,wrapSelector:".swiper-wrap",childSelector:".swiper-item",init:function(t,n){this.$root=e(t),h(this.$root,{visibility:"visible"}),this.reset(n),this.setIndex(this.index),this.startTimer(),this.init=i},reset:function(t){if(t=t||{},["index","ratio","elastic","slideTime","resetTime","nextDistance","interval","repeat","wrapSelector","childSelector","slideCallback"].forEach(function(i,e){s(t,i)&&(this[i]=t[i])}.bind(this)),this.ratio>1&&(this.ratio=1),this.rootWidth=this.$root.clientWidth,this.itemWidth=this.rootWidth*this.ratio,this.$wrap=this.$root.querySelector(this.wrapSelector),this.$childs=r(this.$root.querySelectorAll(this.childSelector)),this.length=this.$childs.length,this.$childs.forEach(function(t,i){t.dataset.index=i}),h(this.$wrap,{width:this.length*this.itemWidth+"px"}),this.ratio>=1)this.visibleCount=1;else{this.visibleCount=Math.floor(1/this.ratio);var i=(1-this.ratio*this.visibleCount)/2;this.visibleCount+=2*Math.ceil(i/this.ratio),this.visibleCount%2==0&&this.visibleCount++}this.oldNextDistance!=this.nextDistance&&(this.nextDistance=this.nextDistance<1?this.nextDistance*this.rootWidth:this.nextDistance,this.oldNextDistance==this.nextDistance),2*(this.visibleCount-1)+1>this.length&&(this.repeat=!1),!this.repeat&&(this.interval=0),this.placeChilds(),this.bindUI()},placeChilds:function(){var t=this.itemWidth;this.$childs.forEach(function(i,e){h(i,{width:t+"px"})})},bindUI:function(){this.touchHolder=m.hold(this.$wrap),this.bindHolder(),this.bindUI=i},bindHolder:function(){var t=this,i=t.touchHolder;i.onStart=function(i){return t.moveStart()},i.onMove=function(i){return t.moveIng(i)},i.onEnd=function(i){return t.moveEnd(i)}},moveStart:function(){var t=this;t.$moves.forEach(function(t){t.dataset.startx=c(t)}),t.isPreventMoving=!1,t.isFirstMove=!0,t.stopTimer()},moveIng:function(t){var i=this,e=t.spaceX,n=t.spaceY;if(i.isPreventMoving||i.isFirstMove&&Math.abs(e)<Math.abs(n))return i.isFirstMove=!1,i.isPreventMoving=!0;if(i.isFirstMove=!1,e*=.85,!i.repeat){var s=i.elastic,r=i.index;(r<=0&&e>0||r>=i.length-1&&e<0)&&(e*=s)}i.$moves.forEach(function(t){l(t,+t.dataset.startx+e,0)})},moveEnd:function(t){var i=this,e=t.spaceX;i.isPreventMoving||(Math.abs(e)>i.nextDistance?e>0?i.prev():i.next():i.$moves.forEach(function(t){l(t,+t.dataset.startx,i.resetTime)})),i.isPreventMoving=!1,i.startTimer()},next:function(t){t="undefined"==typeof t||t,this.setIndex(this.index+1,t)},prev:function(t){t="undefined"==typeof t||t,this.setIndex(this.index-1,t)},setIndex:function(t,i){var e=this;t==e.index?(e.isNext=!1,e.isPrev=!1):(e.isNext=t>e.index,e.isPrev=!e.isNext);var t=e.index=e.fixIndex(t);e.$oldMoves=e.$moves,e.$moves=[];var n=e.visibleCount-1;n<=0&&(n=1);for(var s=t-n,r=t+n;s<=r;)e.$moves.push(e.$childs[e.fixIndex(s)]),s++;e.placeVisibleChilds(i),e.slideCallback.call(e,t)},fixIndex:function(t){var i=this.repeat,e=this.length;if(i){for(;t<0;)t+=e;for(;t>=e;)t-=e;return t}return t<0?0:t>=e?e-1:t},placeVisibleChilds:function(t){var i=this,e=i.itemWidth,n=i.rootWidth;i.$oldMoves&&i.$oldMoves.forEach(function(t){var e=i.getChildOrignX(t.dataset.index);l(t,-e+1.2*n,0)});var s=i.$moves.length,r=Math.ceil(s/2)-1,o=e*s,a=-(o/2-i.rootWidth/2),h=i.$moves;h.forEach(function(n,o){var c,d=n.dataset.index;if(!i.repeat)if(o<r){if(h[o]==h[o+1])return}else if(o>r&&h[o]==h[o-1])return;c=i.isNext&&o==s-1||i.isPrev&&0==o?0:t?i.slideTime:0;var u=i.getChildOrignX(d);l(n,-u+a+e*o,c)})},getChildOrignX:function(t){return+t*this.itemWidth},resize:function(){this.reset(),this.$childs.forEach(function(t,i){l(t,-this.getChildOrignX(i)+1.2*this.rootWidth)}.bind(this)),this.setIndex(this.index)},startTimer:function(){this.interval&&(this.stopTimer(),this.timer=t.setTimeout(function(){this.next(),this.startTimer()}.bind(this),this.interval))},stopTimer:function(){this.interval&&t.clearTimeout(this.timer)}},t.Swiper=d}(window);